{% load static %}
<html>
<head>
    <link rel="stylesheet" href="{% static 'styles.css' %}">
</head>


{% block conteiner %}
{% endblock %}


  {% comment %} Script para abrir modal e recarregar página se o Formulário tiver sido salvo com sucesso {% endcomment %}
  <script>
    document.getElementById('addLista').addEventListener('click', function() {
      document.getElementById('ListaModal').style.display = 'flex';
    });
  
    document.getElementById('ListaForm').addEventListener('submit', function(event) {
      event.preventDefault();
  
      let formData = new FormData(this);
      fetch("{% url 'index' %}", {
        method: 'POST',
        headers: {
          'X-CSRFToken': formData.get('csrfmiddlewaretoken').value
        },
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          document.getElementById('ListaModal').style.display = 'flex';
          location.reload();
          console.log(data.errors);
        }
      })
      .catch(error => console.log('Error:', error));
    });


    {% comment %} Script para atualizar Status da lista {% endcomment %}
    document.querySelectorAll('.todo-complete-checkbox').forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
          let todoId = this.getAttribute('data-todo-id');
          fetch(`/todos/toggle-complete/${todoId}/`, {
            method: 'POST',
            headers: {
              'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
          })
          .then(response => response.json())
          .then(data => {
            if (!data.success) {
              console.error(data.error);
              this.checked = !this.checked; // Reverter a mudança se houver um erro
            }
          })
          .catch(error => console.error('Error:', error));
        });
      });
    
    {% comment %} script para apagar uma tarefa {% endcomment %}

      document.querySelectorAll('.delete-todo-btn').forEach(function(button) {
        button.addEventListener('click', function() {
          if (confirm('Are you sure you want to delete this todo?')) {
            let todoId = this.getAttribute('data-todo-id');
            fetch(`/todos/delete/${todoId}/`, {
              method: 'POST',
              headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
              },
            })
            .then(response => response.json())
            .then(data => {
              console.log(data);
              if (data.success) {
                let todoItem = document.querySelector(`li[data-todo-id="${todoId}"]`);
                location.reload(); // Recarrega a página após a exclusão
                if (todoItem) {
                  todoItem.remove();
                }
              } else {
                console.error(data.error);
              }
            })
            .catch(error => console.error('Error:', error));
          }
        });
      });  

      document.getElementById('addLista').addEventListener('click', function() {
        document.getElementById('ListaModal').style.display = 'flex';
    });
    
    document.querySelector('.closeBtn').addEventListener('click', function() {
        document.getElementById('ListaModal').style.display = 'none';
    });
    
    window.addEventListener('click', function(event) {
        if (event.target == document.getElementById('ListaModal')) {
            document.getElementById('ListaModal').style.display = 'none';
        }
    });


    document.addEventListener('DOMContentLoaded', function() {
      const taskList = document.getElementById('task-list');
  
      // Adiciona a classe de entrada aos itens da lista
      Array.from(taskList.children).forEach(item => {
          item.classList.add('fade-enter');
          // Usar setTimeout para garantir que a classe seja aplicada no próximo ciclo de renderização
          setTimeout(() => {
              item.classList.add('fade-enter-active');
          }, 10); // Pequeno atraso para garantir que a classe 'fade-enter' seja aplicada
      });
  
      // Evento para o formulário de pesquisa
      document.getElementById('form-pesquisa').addEventListener('submit', function(event) {
          event.preventDefault();
          const form = event.target;
  
          // Adiciona a classe de saída aos itens atuais
          Array.from(taskList.children).forEach(item => {
              item.classList.remove('fade-enter', 'fade-enter-active');
              item.classList.add('fade-exit-active');
          });
  
          // Aguarda a transição de saída antes de enviar o formulário
          setTimeout(() => {
              form.submit();
          }, 500); // Duração da transição em milissegundos
      });
  });


  </script>
</html>
  
  
